<div class="reports-container">
  <div class="header">
    <h1>Reportes y Estadísticas</h1>
    <button class="btn btn-primary" (click)="loadAllReports()" [disabled]="isLoading">
      <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
      {{ isLoading ? 'Cargando...' : 'Actualizar' }}
    </button>
  </div>

  <!-- Mensaje de error -->
  <div class="alert alert-danger" *ngIf="errorMessage">
    <i class="fas fa-exclamation-triangle"></i>
    {{ errorMessage }}
  </div>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="isLoading">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Cargando reportes...</p>
  </div>

  <!-- Resumen General -->
  <div class="overview-section" *ngIf="overview && !isLoading">
    <h2 class="section-title">
      <i class="fas fa-chart-line"></i> Resumen General del Sistema
    </h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <i class="fas fa-box"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ overview.summary.total_orders }}</div>
          <div class="stat-label">Total Pedidos</div>
          <div class="stat-detail">
            <span class="badge badge-warning">{{ overview.summary.pending_orders }} Pendientes</span>
            <span class="badge badge-success">{{ overview.summary.delivered_orders || 0 }} Entregados</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <i class="fas fa-truck"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ overview.summary.total_vehicles }}</div>
          <div class="stat-label">Total Vehículos</div>
          <div class="stat-detail">
            <span class="badge badge-success">{{ overview.summary.available_vehicles || 0 }} Disponibles</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <i class="fas fa-id-card"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ overview.summary.total_drivers }}</div>
          <div class="stat-label">Total Conductores</div>
          <div class="stat-detail">
            <span class="badge badge-success">{{ overview.summary.available_drivers || 0 }} Disponibles</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ overview.summary.total_clients }}</div>
          <div class="stat-label">Total Clientes</div>
        </div>
      </div>

      <div class="stat-card highlight">
        <div class="stat-icon" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(overview.summary.total_value || 0) }}</div>
          <div class="stat-label">Valor Total</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ overview.summary.recent_orders || 0 }}</div>
          <div class="stat-label">Pedidos (30 días)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reporte de Pedidos -->
  <div class="report-section" *ngIf="ordersSummary && !isLoading">
    <h2 class="section-title">
      <i class="fas fa-box icon"></i> Reporte de Pedidos
    </h2>
    <div class="report-grid">
      <div class="report-card">
        <h3>Total de Pedidos</h3>
        <div class="big-number">{{ ordersSummary.total_orders }}</div>
        <div class="sub-info">
          <span class="badge badge-primary">{{ ordersSummary.assigned || 0 }} Asignados</span>
          <span class="badge badge-secondary">{{ ordersSummary.unassigned || 0 }} Sin Asignar</span>
        </div>
      </div>

      <div class="report-card" *ngIf="ordersSummary.total_value && ordersSummary.total_value > 0">
        <h3>Valor Total</h3>
        <div class="big-number">{{ formatCurrency(ordersSummary.total_value || 0) }}</div>
      </div>
    </div>

    <div class="chart-container">
      <h3>Pedidos por Estado</h3>
      <div class="chart-content">
        <div class="chart-item" *ngFor="let item of ordersSummary.by_status | keyvalue">
          <div class="chart-bar-container">
            <div class="chart-bar-label">{{ item.key | titlecase }}</div>
            <div class="chart-bar-wrapper">
              <div class="chart-bar" [style.width.%]="(item.value / ordersSummary.total_orders) * 100" 
                   [style.background-color]="getStatusColor(item.key)">
                <span class="chart-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="ordersSummary.by_priority && Object.keys(ordersSummary.by_priority).length > 0">
      <h3>Pedidos por Prioridad</h3>
      <div class="chart-content">
        <div class="chart-item" *ngFor="let item of ordersSummary.by_priority | keyvalue">
          <div class="priority-badge" [style.background-color]="getPriorityColor(item.key)">
            {{ item.key | titlecase }}: {{ item.value }}
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="ordersSummary.by_destination && Object.keys(ordersSummary.by_destination).length > 0">
      <h3>Top Ciudades Destino</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Ciudad</th>
              <th>Pedidos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of ordersSummary.by_destination | keyvalue">
              <td>{{ item.key }}</td>
              <td><strong>{{ item.value }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Reporte de Vehículos -->
  <div class="report-section" *ngIf="vehiclesSummary && !isLoading">
    <h2 class="section-title">
      <i class="fas fa-truck icon"></i> Reporte de Vehículos
    </h2>
    <div class="report-grid">
      <div class="report-card">
        <h3>Total Vehículos</h3>
        <div class="big-number">{{ vehiclesSummary.total_vehicles }}</div>
        <div class="sub-info">
          <span class="badge badge-success">{{ vehiclesSummary.available || 0 }} Disponibles</span>
          <span class="badge badge-warning">{{ vehiclesSummary.busy || 0 }} En Uso</span>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="vehiclesSummary.by_type && Object.keys(vehiclesSummary.by_type).length > 0">
      <h3>Vehículos por Tipo</h3>
      <div class="chart-content">
        <div class="chart-item" *ngFor="let item of vehiclesSummary.by_type | keyvalue">
          <div class="chart-bar-container">
            <div class="chart-bar-label">{{ item.key | titlecase }}</div>
            <div class="chart-bar-wrapper">
              <div class="chart-bar" [style.width.%]="(item.value / vehiclesSummary.total_vehicles) * 100">
                <span class="chart-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="vehiclesSummary.top_vehicles && vehiclesSummary.top_vehicles.length > 0">
      <h3>Top Vehículos por Pedidos</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Placa</th>
              <th>Tipo</th>
              <th>Pedidos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of vehiclesSummary.top_vehicles">
              <td><strong>{{ vehicle.license_plate }}</strong></td>
              <td>{{ vehicle.vehicle_type | titlecase }}</td>
              <td><span class="badge badge-info">{{ vehicle.order_count }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Reporte de Conductores -->
  <div class="report-section" *ngIf="driversSummary && !isLoading">
    <h2 class="section-title">
      <i class="fas fa-id-card icon"></i> Reporte de Conductores
    </h2>
    <div class="report-grid">
      <div class="report-card">
        <h3>Total Conductores</h3>
        <div class="big-number">{{ driversSummary.total_drivers }}</div>
        <div class="sub-info">
          <span class="badge badge-success">{{ driversSummary.available_drivers }} Disponibles</span>
          <span class="badge badge-warning">{{ driversSummary.busy_drivers }} Ocupados</span>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="driversSummary.top_drivers && driversSummary.top_drivers.length > 0">
      <h3>Top Conductores por Pedidos</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Documento</th>
              <th>Pedidos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let driver of driversSummary.top_drivers">
              <td><strong>{{ driver.name }}</strong></td>
              <td>{{ driver.document_number }}</td>
              <td><span class="badge badge-info">{{ driver.order_count }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Reporte de Clientes -->
  <div class="report-section" *ngIf="clientsSummary && !isLoading">
    <h2 class="section-title">
      <i class="fas fa-users icon"></i> Reporte de Clientes
    </h2>
    <div class="report-grid">
      <div class="report-card">
        <h3>Total Clientes</h3>
        <div class="big-number">{{ clientsSummary.total_clients }}</div>
        <div class="sub-info" *ngIf="clientsSummary.clients_without_orders !== undefined">
          <span class="badge badge-secondary">{{ clientsSummary.clients_without_orders }} Sin Pedidos</span>
        </div>
      </div>
    </div>

    <div class="chart-container" *ngIf="clientsSummary.top_clients && clientsSummary.top_clients.length > 0">
      <h3>Top Clientes</h3>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Empresa</th>
              <th>Pedidos</th>
              <th>Valor Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let client of clientsSummary.top_clients">
              <td><strong>{{ client.name }}</strong></td>
              <td>{{ client.company }}</td>
              <td><span class="badge badge-info">{{ client.order_count }}</span></td>
              <td><strong>{{ formatCurrency(client.total_value) }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="chart-container" *ngIf="clientsSummary.by_company && Object.keys(clientsSummary.by_company).length > 0">
      <h3>Clientes por Empresa</h3>
      <div class="chart-content">
        <div class="chart-item" *ngFor="let item of clientsSummary.by_company | keyvalue">
          <div class="chart-bar-container">
            <div class="chart-bar-label">{{ item.key }}</div>
            <div class="chart-bar-wrapper">
              <div class="chart-bar" [style.width.%]="(item.value / clientsSummary.total_clients) * 100">
                <span class="chart-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!isLoading && !overview && !errorMessage">
    <i class="fas fa-chart-line"></i>
    <h4>No hay datos disponibles</h4>
    <p>Los reportes se mostrarán cuando haya información en el sistema.</p>
  </div>
</div>
