<div class="orders-container">
  <!-- Encabezado -->
  <div class="header">
    <h1>Gestión de Vehículos</h1>
    <button class="btn btn-primary" (click)="showCreateForm()">
      <i class="fas fa-plus"></i> Nuevo Vehículo
    </button>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="cancelForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ isEditing ? 'Editar Vehículo' : 'Nuevo Vehículo' }}</h3>
        <button class="btn-close" (click)="cancelForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="alert alert-danger" *ngIf="errorMessage">
          <i class="fas fa-exclamation-triangle"></i> {{ errorMessage }}
        </div>
        <div class="alert alert-success" *ngIf="successMessage">
          <i class="fas fa-check-circle"></i> {{ successMessage }}
        </div>

        <form (ngSubmit)="isEditing ? updateVehicle() : submit()" class="order-form">
          <div class="form-row">
            <div class="form-group">
              <label for="license_plate">Placa *</label>
              <input id="license_plate" name="license_plate" [(ngModel)]="form.license_plate" required />
            </div>
            <div class="form-group">
              <label for="brand">Marca *</label>
              <input id="brand" name="brand" [(ngModel)]="form.brand" required />
            </div>
            <div class="form-group">
              <label for="model">Modelo *</label>
              <input id="model" name="model" [(ngModel)]="form.model" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="year">Año</label>
              <input id="year" name="year" type="number" [(ngModel)]="form.year" min="1900" max="2100" />
            </div>
            <div class="form-group">
              <label for="vehicle_type">Tipo</label>
              <select id="vehicle_type" name="vehicle_type" [(ngModel)]="form.vehicle_type">
                <option value="camioneta">Camioneta</option>
                <option value="furgon">Furgón</option>
                <option value="camion">Camión</option>
                <option value="moto">Moto</option>
              </select>
            </div>
            <div class="form-group">
              <label for="status">Estado</label>
              <select id="status" name="status" [(ngModel)]="form.status">
                <option value="disponible">Disponible</option>
                <option value="en_ruta">En ruta</option>
                <option value="mantenimiento">Mantenimiento</option>
              </select>
            </div>
          </div>

          <div class="form-group checkbox-group">
            <input type="checkbox" id="is_available" name="is_available" [(ngModel)]="form.is_available" />
            <label for="is_available">Disponible</label>
          </div>

          <div class="modal-actions">
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
              <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
              <i class="fas fa-save" *ngIf="!isLoading"></i>
              {{ isLoading ? 'Guardando...' : (isEditing ? 'Actualizar' : 'Crear') }} Vehículo
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancelForm()" [disabled]="isLoading">
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Lista -->
  <div class="orders-list">
    <div class="list-header">
      <h3>Lista de Vehículos ({{ vehicles.length }})</h3>
    </div>

    <div class="table-container">
      <table class="orders-table">
        <thead>
          <tr>
            <th>Placa</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Año</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Disponible</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let v of vehicles; trackBy: trackByVehicle" class="order-row">
            <td>{{ v.license_plate }}</td>
            <td>{{ v.brand }}</td>
            <td>{{ v.model }}</td>
            <td>{{ v.year }}</td>
            <td>{{ v.vehicle_type }}</td>
            <td>{{ formatStatus(v.status) }}</td>
            <td>
              <span class="priority-badge" [ngClass]="v.is_available ? 'priority-baja' : 'priority-alta'">
                {{ v.is_available ? 'Sí' : 'No' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button type="button" (click)="showEditForm(v)" class="btn btn-sm btn-outline-primary" title="Editar">
                  <i class="fas fa-edit"></i>
                </button>
                <button type="button" (click)="deleteVehicle(v)" class="btn btn-sm btn-outline-danger" title="Eliminar">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="vehicles.length === 0" class="empty-state">
      <i class="fas fa-car"></i>
      <h4>No hay vehículos registrados</h4>
      <p>Crea tu primer vehículo para comenzar</p>
      <button class="btn btn-primary" (click)="showCreateForm()">
        <i class="fas fa-plus"></i> Crear Vehículo
      </button>
    </div>
  </div>
</div>
